<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pedidos La Carpita - Asistente</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* =============== RESET =============== */
*{box-sizing:border-box;margin:0;padding:0;}

/* =============== THEME VARIABLES =============== */
:root{
  --bg-body: linear-gradient(135deg,#ffe082,#ffca28);
  --text-color:#3e2723;
  --app-bg:#ffffff;
  --header-bg:#ffb300;
  --header-text:#3e2723;
  --step-bg:#f5f5f5;
  --step-bg-active:#ffe082;
  --step-text:#777;
  --step-text-active:#e65100;
  --step-circle-border:#bdbdbd;
  --step-circle-border-active:#ff8f00;
  --step-circle-bg-active:#ffb300;
  --card-bg:#fafafa;
  --card-border:#eee;
  --label-color:#555;
  --input-bg:#ffffff;
  --input-border:#ddd;
  --input-border-focus:#ffb300;
  --table-header-bg:#fffde7;
  --table-header-text:#6d4c41;
  --table-border:#eee;
  --badge-bg:#e0f2f1;
  --badge-text:#00695c;
  --btn-primary-bg:#ff9800;
  --btn-primary-bg-hover:#fb8c00;
  --btn-primary-text:#ffffff;
  --btn-secondary-bg:#eeeeee;
  --btn-secondary-bg-hover:#e0e0e0;
  --btn-secondary-text:#424242;
  --total-final:#c62828;
  --envio-bg:#fff8e1;
  --envio-border:#ffb300;
  --envio-text:#e65100;
  --floating-bg:#ffffff;
  --floating-text:#3e2723;
  --floating-shadow:0 4px 12px rgba(0,0,0,0.18);
}

/* Dark theme overrides via attribute on <html> */
:root[data-theme="dark"]{
  --bg-body: radial-gradient(circle at top,#4e342e,#212121);
  --text-color:#f5f5f5;
  --app-bg:#2b2620;
  --header-bg:#ffb300;
  --header-text:#3e2723;
  --step-bg:#4e342e;
  --step-bg-active:#ffb74d;
  --step-text:#d7ccc8;
  --step-text-active:#3e2723;
  --step-circle-border:#ffcc80;
  --step-circle-border-active:#ff6f00;
  --step-circle-bg-active:#ff8f00;
  --card-bg:#3a3029;
  --card-border:#5d4037;
  --label-color:#f5f5f5;
  --input-bg:#4e342e;
  --input-border:#8d6e63;
  --input-border-focus:#ffb300;
  --table-header-bg:#4e342e;
  --table-header-text:#ffecb3;
  --table-border:#5d4037;
  --badge-bg:#004d40;
  --badge-text:#e0f2f1;
  --btn-primary-bg:#ff9800;
  --btn-primary-bg-hover:#fb8c00;
  --btn-primary-text:#212121;
  --btn-secondary-bg:#5d4037;
  --btn-secondary-bg-hover:#4e342e;
  --btn-secondary-text:#ffe0b2;
  --total-final:#ffcc80;
  --envio-bg:#5d4037;
  --envio-border:#ffb74d;
  --envio-text:#ffe082;
  --floating-bg:#3a3029;
  --floating-text:#ffecb3;
  --floating-shadow:0 4px 14px rgba(0,0,0,0.45);
}

/* =============== GLOBAL =============== */
body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg-body);
  color:var(--text-color);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:20px 10px;
  font-size:17px !important;
  line-height:1.45;
}

/* =============== APP CONTAINER =============== */
.app{
  width:100%;
  max-width:900px;
  background:var(--app-bg);
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
  overflow:hidden;
}

/* =============== HEADER =============== */
header{
  padding:14px 18px;
  background:var(--header-bg);
  color:var(--header-text);
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}
header h1{
  font-size:1.6rem !important;
  font-weight:800 !important;
}
header span{
  font-size:1rem !important;
  opacity:0.8;
}
.header-right{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:0.85rem;
}

/* =============== MAIN =============== */
main{padding:16px 18px 20px;}

/* =============== STEPS TOP =============== */
.steps{
  display:flex;
  justify-content:space-between;
  gap:6px;
  margin-bottom:8px;
}
.step-indicator{
  flex:1;
  text-align:center;
  font-size:0.95rem !important;
  padding:6px 8px;
  border-radius:999px;
  background:var(--step-bg);
  color:var(--step-text);
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
}
.step-indicator span.circle{
  width:24px !important;
  height:24px !important;
  border-radius:999px;
  border:2px solid var(--step-circle-border);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:0.9rem !important;
}
.step-indicator.active{
  background:var(--step-bg-active);
  color:var(--step-text-active);
  font-weight:700;
}
.step-indicator.active span.circle{
  border-color:var(--step-circle-border-active);
  background:var(--step-circle-bg-active);
  color:#fff;
}

/* =============== PROGRESS BAR =============== */
.progress-wrapper{
  margin-bottom:14px;
}
.progress-text{
  font-size:0.9rem;
  margin-bottom:4px;
  color:var(--label-color);
}
.progress-bar{
  width:100%;
  height:8px;
  border-radius:999px;
  background:rgba(0,0,0,0.08);
  overflow:hidden;
}
.progress-fill{
  height:100%;
  width:25%;
  border-radius:999px;
  background:linear-gradient(90deg,#ffca28,#ff9800);
  transition:width .2s ease-out;
}

/* =============== ANIMACI√ìN =============== */
.step{display:none;animation:fadeIn .25s ease-out;}
.step.active{display:block;}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(4px);}
  to{opacity:1;transform:translateY(0);}
}

/* =============== TITULOS & TEXTOS =============== */
h2{
  font-size:1.4rem !important;
  margin-bottom:12px;
  color:#f5f5f5;
  color:var(--text-color);
  font-weight:700;
}
p.helper{
  font-size:1rem !important;
  color:#757575;
  opacity:0.9;
  margin-bottom:12px;
}

/* =============== CARD =============== */
.card{
  background:var(--card-bg);
  border-radius:14px;
  padding:14px 16px;
  border:1px solid var(--card-border);
  margin-bottom:12px;
}

/* =============== LABELS =============== */
label{
  display:block;
  font-size:1rem !important;
  margin-top:8px;
  margin-bottom:4px;
  color:var(--label-color);
}

/* =============== INPUTS & SELECTS =============== */
select,input[type="text"],input[type="number"],textarea{
  width:100%;
  padding:11px 14px !important;
  border-radius:10px;
  border:1px solid var(--input-border);
  font-size:1rem !important;
  outline:none;
  transition:border .15s,box-shadow .15s,background .15s;
  background:var(--input-bg);
  color:var(--text-color);
}
select:focus,input:focus,textarea:focus{
  border-color:var(--input-border-focus);
  box-shadow:0 0 0 2px rgba(255,179,0,0.25);
}
textarea{
  resize:vertical;
  min-height:70px;
}

/* =============== GRID =============== */
.row{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
}
.col{
  flex:1 1 200px;
}

/* =============== RADIO BUTTONS =============== */
.radio-group{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  font-size:1rem !important;
  margin-top:6px;
}
.radio-group label{
  margin:0;
  padding:6px 12px;
  border-radius:999px;
  border:1px solid var(--input-border);
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  gap:6px;
  background:var(--input-bg);
  font-size:0.95rem !important;
}
.radio-group input{
  accent-color:#ff9800;
}

/* =============== TITULITOS DE OPCIONES =============== */
.option-title{
  font-size:1rem !important;
  font-weight:600;
  color:#5d4037;
}
:root[data-theme="dark"] .option-title{
  color:#ffecb3;
}
.note{
  font-size:0.9rem !important;
  color:#9e9e9e;
  margin-top:4px;
}

/* =============== BOTONES =============== */
button{
  border:none;
  border-radius:999px;
  padding:12px 22px !important;
  font-size:1rem !important;
  font-weight:700 !important;
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  transition:background .15s,transform .1s,box-shadow .15s;
}
button:active{transform:scale(0.97);}
.btn-primary{
  background:var(--btn-primary-bg);
  color:var(--btn-primary-text);
  box-shadow:0 3px 10px rgba(255,152,0,0.35);
}
.btn-primary:hover{background:var(--btn-primary-bg-hover);}
.btn-secondary{
  background:var(--btn-secondary-bg);
  color:var(--btn-secondary-text);
}
.btn-secondary:hover{background:var(--btn-secondary-bg-hover);}

.actions{
  margin-top:14px;
  display:flex;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}

.btn-theme{
  padding:8px 14px !important;
  font-size:0.9rem !important;
}

/* =============== TABLAS =============== */
table{
  width:100%;
  border-collapse:collapse;
  font-size:1rem !important;
  margin-top:10px;
}
th,td{
  padding:8px 10px;
  border-bottom:1px solid var(--table-border);
  vertical-align:top;
}
th{
  background:var(--table-header-bg);
  text-align:left;
  color:var(--table-header-text);
}
tfoot td{
  font-weight:700;
  border-top:1px solid var(--table-border);
}

.total-row{font-size:1.1rem !important;}
.total-final{
  font-size:1.3rem !important;
  color:var(--total-final);
  font-weight:800;
}

/* Badges */
.badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  background:var(--badge-bg);
  color:var(--badge-text);
  font-size:0.9rem !important;
}

/* --- SEPARACI√ìN ENTRE TABLA Y TOTAL --- */
table tfoot tr.total-row td {
  padding-top: 10px;
  padding-bottom: 10px;
}

/* === ENV√çO A DOMICILIO SUPER DESTACADO === */
#rowEnvio {
    background: #ffe9b3 !important;                       /* Amarillo m√°s fuerte */
    border: 3px solid #ffb300 !important;                 /* Borde grueso */
    color: #d35400 !important;                            /* Texto m√°s visible */
    box-shadow: 0 4px 12px rgba(255, 157, 0, 0.25) !important;
    transition: 0.25s ease !important;
}

/* Hover bonito */
#rowEnvio:hover {
    background: #ffd480 !important;
    transform: scale(1.01);
    box-shadow: 0 6px 16px rgba(255, 140, 0, 0.35) !important;
}

/* Icono del cami√≥n m√°s grande */
#rowEnvio .envio-icon {
    font-size: 1.6rem !important;
    margin-right: 10px;
}

/* Texto del label m√°s grande */
#rowEnvio label {
    font-size: 1.15rem !important;
    font-weight: 800 !important;
    color: #e65100 !important;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Checkbox m√°s grande */
#chkEnvio {
    transform: scale(1.4);
    accent-color: #ff6f00 !important;
}

/* Precio del env√≠o a la derecha destacado */
#costoEnvio {
    color: #e65100 !important;
    font-size: 1.2rem !important;
    font-weight: 900 !important;
}


/* --- BOT√ìN ‚ÄúAGREGAR OTRO ALIMENTO‚Äù --- */
#btnAgregarOtro {
  background: #ffe0b2 !important;
  color: #e65100 !important;
  font-weight: 700 !important;
  padding: 12px 20px !important;
  border-radius: 18px !important;
  border: 2px solid #ffb74d !important;
  box-shadow: 0 3px 8px rgba(255, 152, 0, 0.25) !important;
  transition: 0.2s ease !important;
}
#btnAgregarOtro:hover {
  background: #ffcc80 !important;
  border-color: #ffa726 !important;
  transform: translateY(-2px) !important;
  box-shadow: 0 6px 12px rgba(255, 152, 0, 0.35) !important;
}
#btnAgregarOtro:active {
  transform: scale(0.96);
}

/* === CARRITO FLOTANTE M√ÅS LLAMATIVO === */
.floating-cart{
    position: fixed;
    right: 16px;
    bottom: 16px;
    padding: 14px 20px !important;
    border-radius: 25px !important;
    background: linear-gradient(135deg, #ffb300, #ff6f00) !important;
    color: #ffffff !important;
    font-size: 1.1rem !important;
    font-weight: 800 !important;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    z-index: 1000;
    opacity: 0;
    pointer-events: none;
    transform: translateY(8px);
    transition: opacity .25s ease, transform .25s ease, box-shadow .25s ease;
    box-shadow: 0 6px 18px rgba(255, 152, 0, 0.55) !important;
}

/* visible */
.floating-cart.visible{
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
}

/* Icono m√°s grande */
.floating-cart span:first-child{
    font-size: 1.4rem !important;
}

/* Efecto hover */
.floating-cart:hover{
    box-shadow: 0 10px 22px rgba(255, 152, 0, 0.75) !important;
    transform: translateY(-3px);
}

/* Efecto ‚Äúlatidos‚Äù para llamar la atenci√≥n */
@keyframes pulseCart{
    0% { transform: scale(1); }
    50% { transform: scale(1.06); }
    100% { transform: scale(1); }
}

.floating-cart.visible{
    animation: pulseCart 1.8s infinite ease-in-out;
}

/* =============== RESPONSIVE =============== */
@media (max-width:600px){
  header h1{font-size:1.3rem !important;}
  .step-indicator{font-size:0.8rem !important;}
}

/* AUMENTAR LETRA DE ALIMENTOS (selects y textos de productos) */
#categoria,
#producto,
#producto option,
#categoria option {
    font-size: 1.25rem !important;  /* Ajusta si quieres m√°s grande */
    font-weight: 700 !important;
}

/* T√≠tulos de alimentos en paso final */
#detallePedido td:first-child {
    font-size: 1.15rem !important;
    font-weight: 700 !important;
    line-height: 1.35;
}

/* T√≠tulos dentro de tarjetas (aderezos, papas, combos, etc.) */
.option-title {
    font-size: 1.2rem !important;
    font-weight: 800 !important;
}

/* Cuando muestras el alimento en la confirmaci√≥n */
#resumenItemActual {
    font-size: 1.2rem !important;
    font-weight: 700;
}
/* Aumentar tama√±o SOLO para los nombres del combo: Boneless, Alitas, Dedos */
#contenedorAderezosCombo > div > div:first-child {
    font-size: 1.4rem !important;      /* M√°s grande */
    font-weight: 900 !important;       /* Super negrita */
    color: #3e2723 !important;         /* Color m√°s fuerte */
    margin-bottom: 6px;
    margin-top: 4px;
    letter-spacing: 0.5px;
}
/* ===== RADIO BUTTONS MODERNOS TIPO CHIPS ===== */
.radio-group label {
    padding: 10px 16px !important;
    border: 2px solid #e0e0e0 !important;
    border-radius: 25px !important;
    background: #ffffff !important;
    font-size: 1.05rem !important;
    font-weight: 600 !important;
    color: #5d4037 !important;
    transition: 0.25s ease !important;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08) !important;
}

/* Hover bonito */
.radio-group label:hover {
    border-color: #ffb300 !important;
    background: #fff3cd !important; /* Amarillo suave */
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(255,180,0,0.25) !important;
}

/* Ocultar radio nativo */
.radio-group input[type="radio"] {
    display: none !important;
}

/* Estado seleccionado */
.radio-group input[type="radio"]:checked + label,
.radio-group label:has(input[type="radio"]:checked) {
    background: #ffb300 !important;
    color: white !important;
    border-color: #ff8f00 !important;
    box-shadow: 0 4px 12px rgba(255,150,0,0.35) !important;
    transform: translateY(-2px);
}

/* Punto circular dentro del bot√≥n */
.radio-group label::before {
    content: "";
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid #ff9800;
    background: white;
    display: inline-block;
    margin-right: 8px;
    vertical-align: middle;
    transition: 0.25s ease;
}

/* Cuando est√° seleccionado, el circulito se pinta */
.radio-group input[type="radio"]:checked + label::before,
.radio-group label:has(input[type="radio"]:checked)::before {
    background: white;
    border-color: white;
    box-shadow: 0 0 0 6px rgba(255,255,255,0.4) inset;
}

/* Ajuste para modo oscuro */
:root[data-theme="dark"] .radio-group label {
    background: #4e342e !important;
    color: #ffe0b2 !important;
    border-color: #6d4c41 !important;
}

:root[data-theme="dark"] .radio-group label:hover {
    background: #795548 !important;
    border-color: #ffb300 !important;
}

:root[data-theme="dark"] .radio-group input[type="radio"]:checked + label,
:root[data-theme="dark"] .radio-group label:has(input[type="radio"]:checked) {
    background: #ff9800 !important;
    color: #212121 !important;
}
/* ==== FORMULARIO DE CLIENTE M√ÅS LLAMATIVO ==== */

/* Fondo de cada card */


/* T√≠tulos de los labels */
.card label {
    font-size: 1.15rem !important;
    font-weight: 700 !important;
    color: #8a5200 !important; /* Caf√© c√°lido */
    margin-bottom: 6px;
}



/* Placeholder m√°s visible */
.card input::placeholder,
.card textarea::placeholder {
    color: #b57a00 !important;
    opacity: 0.7;
    font-weight: 500;
}

/* Inputs grandes en filas */
.card .row .col {
    margin-bottom: 12px;
}

/* √Årea de texto m√°s redondeada */
.card textarea {
    border-radius: 14px !important;
}

/* Subt√≠tulos */
.card .note {
    font-size: 0.95rem !important;
    color: #a16c00 !important;
}
#listaSugerencias {
    background: var(--card-bg) !important;
    border: 2px solid var(--card-border) !important;
    border-radius: 12px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.25);
}

#listaSugerencias div {
    color: var(--text-color) !important;
    border-bottom: 1px solid var(--card-border) !important;
    background: var(--card-bg) !important;
}

#listaSugerencias div:hover {
    background: var(--step-bg-active) !important;
}

/* ==== ARREGLA EL BUSCADOR EN MODO OSCURO ==== */
:root[data-theme="dark"] input,
:root[data-theme="dark"] select,
:root[data-theme="dark"] textarea {
    background: #3b2a23 !important; 
    color: #ffecb3 !important;
    border-color: #8d6e63 !important;
}

:root[data-theme="dark"] input:focus,
:root[data-theme="dark"] select:focus,
:root[data-theme="dark"] textarea:focus {
    background: #4a352d !important;
    box-shadow: 0 0 0 3px rgba(255,179,0,0.3) !important;
}

</style>

</head>
<body>
<div class="app">
  <header>
    <div>
      <h1>Pedidos La Carpita</h1>
      <span>Asistente paso a paso</span>
    </div>
    <div class="header-right">
      <div>
        Env√≠o: <strong>$10</strong> (opcional)
      </div>
      <button type="button" class="btn-secondary btn-theme" id="btnTheme" title="Cambiar tema">
        üåô
      </button>
    </div>
  </header>

  <main>
    <!-- Indicador de pasos -->
    <div class="steps">
      <div class="step-indicator active" data-step-ind="1">
        <span class="circle">1</span> Alimento
      </div>
      <div class="step-indicator" data-step-ind="2">
        <span class="circle">2</span> Personalizar
      </div>
      <div class="step-indicator" data-step-ind="3">
        <span class="circle">3</span> Confirmar
      </div>
      <div class="step-indicator" data-step-ind="4">
        <span class="circle">4</span> Total y env√≠o
      </div>
    </div>

    <!-- Barra de progreso -->
    <div class="progress-wrapper">
      <div class="progress-text" id="progressText">Paso 1 de 4</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>

    <!-- PASO 1 -->
    <section class="step active" id="step1">
      <h2>Paso 1 ¬∑ Elige el alimento</h2>
<!-- Buscador global con autocomplete -->
<div class="card" style="margin-bottom:12px; position:relative;">
  <label for="buscadorGlobal" style="font-weight:800; font-size:1.1rem;">
    üîç Buscar alimento (global)
  </label>
  <input 
    type="text" 
    id="buscadorGlobal" 
    placeholder="Escribe: boneless, combo, papas, dedos, alitas..."
    style="font-size:1.2rem; padding:12px; border-radius:14px;"
  >

  <!-- Contenedor de sugerencias -->
  <div id="listaSugerencias" 
       style="#buscadorGlobal {
    background: var(--input-bg) !important;
    border: 2px solid var(--input-border) !important;
    color: var(--text-color) !important;
    padding: 12px 16px !important;
    border-radius: 12px !important;
    font-size: 1.15rem !important;
    transition: 0.2s ease;
}

#buscadorGlobal::placeholder {
    color: var(--label-color) !important;
    opacity: 0.7 !important;
}

#buscadorGlobal:focus {
    border-color: var(--input-border-focus) !important;
    box-shadow: 0 0 0 3px rgba(255,179,0,0.3) !important;
}
">
  </div>
</div>

      <p class="helper">Selecciona la categor√≠a y el alimento que vas a agregar al pedido.</p>

      <div class="card">
        <div class="row">
          <div class="col">
            <label for="categoria">Categor√≠a</label>
            <select id="categoria">
              <option value="individual">Individuales</option>
              <option value="banderillas">Banderillas</option>
              <option value="mini">Mini banderillas</option>
              <option value="papas">Papas solas</option>
              <option value="super">S√∫per Combos (2 alimentos + papas)</option>
              <option value="mega">Mega Combos</option>
              <option value="extra">Extras</option>
            </select>
          </div>
          <div class="col">
            <label for="producto">Alimento</label>
            <select id="producto"></select>
          </div>
        </div>
        <p class="note">Cada vez que contin√∫es se agregar√° <strong>1</strong> unidad de este alimento. Si el cliente quiere m√°s, simplemente lo agregas de nuevo.</p>
      </div>

      <div class="actions">
        <span></span>
        <button class="btn-primary" id="btnPaso1">
          Siguiente ¬∑ Personalizar ‚Üí
        </button>
      </div>
    </section>

    <!-- PASO 2 -->
    <section class="step" id="step2">
      <h2>Paso 2 ¬∑ Personaliza el alimento</h2>
      <p class="helper">Aderezos, papas y salsas seg√∫n el tipo de alimento.</p>

      <!-- Tarjeta de opciones -->
      <div class="card">

        <!-- Aderezo individual -->
        <div id="seccionAderezoIndividual">
          <div class="option-title">Aderezo del alimento (incluye 1)</div>
          <label for="aderezoPrincipal">Aderezo incluido</label>
          <select id="aderezoPrincipal"></select>

          <label class="option-title">¬øC√≥mo va el aderezo?</label>
          <div class="radio-group">
            <label><input type="radio" name="modoAderezoPrincipal" value="Untado" checked> Untado</label>
            <label><input type="radio" name="modoAderezoPrincipal" value="Aparte"> Aparte</label>
            <label><input type="radio" name="modoAderezoPrincipal" value="Sin"> Solo (sin aderezo)</label>
          </div>

          <div style="margin-top:6px;">
            <label style="font-size:0.8rem;">
              <input type="checkbox" id="chkDobleAderezo">
              Agregar doble aderezo (+$8)
            </label>
          </div>

          <div id="seccionDobleAderezo" style="display:none;margin-top:6px;">
            <label for="aderezoExtra">Segundo aderezo</label>
            <select id="aderezoExtra"></select>

            <label class="option-title">¬øC√≥mo va el segundo aderezo?</label>
            <div class="radio-group">
              <label><input type="radio" name="modoAderezoExtra" value="Untado" checked> Untado</label>
              <label><input type="radio" name="modoAderezoExtra" value="Aparte"> Aparte</label>
            </div>
          </div>

          <hr style="border:none;border-top:1px dashed #e0e0e0;margin:10px 0;">
        </div>

        <!-- Papas (tipo y salsas) -->
        <div id="seccionTipoPapas">
          <div class="option-title">Papas del alimento</div>
          <label for="tipoPapa">Tipo de papa</label>
          <select id="tipoPapa">
    <option value="Francesa" data-extra="8">Francesa</option>
    <option value="Curly" data-extra="8">Curly</option>
    <option value="Waffle" data-extra="8">Waffle</option>
    <option value="Gajo" data-extra="8">Gajo</option>
</select>
          <p class="note">Cambio de tipo de papa tiene costo adicional de $8.</p>
        </div>

        <div id="seccionCondimentosPapas" style="margin-top:8px;">
          <div class="option-title">Queso, catsup y salsa en las papas</div>
          <div class="row">
            <div class="col">
              <label>Queso</label>
              <div class="radio-group">
                <label><input type="radio" name="quesoPapa" value="Untado" checked> Untado</label>
                <label><input type="radio" name="quesoPapa" value="Aparte"> Aparte</label>
                <label><input type="radio" name="quesoPapa" value="Sin"> Solas (sin queso)</label>
              </div>
            </div>
            <div class="col">
              <label>Catsup</label>
              <div class="radio-group">
                <label><input type="radio" name="catsupPapa" value="Untado" checked> Untado</label>
                <label><input type="radio" name="catsupPapa" value="Aparte"> Aparte</label>
                <label><input type="radio" name="catsupPapa" value="Sin"> Solas (sin catsup)</label>
              </div>
            </div>
            <div class="col">
              <label>Salsa</label>
              <div class="radio-group">
                <label><input type="radio" name="salsaPapa" value="Untado" checked> Untado</label>
                <label><input type="radio" name="salsaPapa" value="Aparte"> Aparte</label>
                <label><input type="radio" name="salsaPapa" value="Sin"> Solas (sin salsa)</label>
              </div>
            </div>
          </div>
          <hr style="border:none;border-top:1px dashed #e0e0e0;margin:10px 0;">
        </div>

        <!-- Mini banderillas / banderillas -->
        <div id="seccionMiniBanderillas">
          <div class="option-title">Mini banderillas / Banderillas</div>
          <p class="note">Incluyen queso, catsup, mayonesa y salsa. Elige si van untados, aparte o solas.</p>
          <div class="row">
            <div class="col">
              <label>Queso</label>
              <div class="radio-group">
                <label><input type="radio" name="quesoMini" value="Untado" checked> Untado</label>
                <label><input type="radio" name="quesoMini" value="Aparte"> Aparte</label>
                <label><input type="radio" name="quesoMini" value="Sin"> Sin</label>
              </div>
            </div>
            <div class="col">
              <label>Catsup</label>
              <div class="radio-group">
                <label><input type="radio" name="catsupMini" value="Untado" checked> Untado</label>
                <label><input type="radio" name="catsupMini" value="Aparte"> Aparte</label>
                <label><input type="radio" name="catsupMini" value="Sin"> Sin</label>
              </div>
            </div>
            <div class="col">
              <label>Mayonesa</label>
              <div class="radio-group">
                <label><input type="radio" name="mayoMini" value="Untado" checked> Untado</label>
                <label><input type="radio" name="mayoMini" value="Aparte"> Aparte</label>
                <label><input type="radio" name="mayoMini" value="Sin"> Sin</label>
              </div>
            </div>
            <div class="col">
              <label>Salsa</label>
              <div class="radio-group">
                <label><input type="radio" name="salsaMini" value="Untado" checked> Untado</label>
                <label><input type="radio" name="salsaMini" value="Aparte"> Aparte</label>
                <label><input type="radio" name="salsaMini" value="Sin"> Sin</label>
              </div>
            </div>
          </div>
          <hr style="border:none;border-top:1px dashed #e0e0e0;margin:10px 0;">
        </div>

        <!-- Aderezos para combos -->
        <div id="seccionAderezosCombo">
          <div class="option-title">Aderezos por alimento del combo</div>
          <div id="contenedorAderezosCombo"></div>
          <p class="note">Cada alimento del combo incluye 1 aderezo. Si se marca doble aderezo se agregan $8 por cada alimento con extra.</p>
        </div>

      </div>

      <div class="actions">
        <button class="btn-secondary" id="btnBack2">‚Üê Volver</button>
        <button class="btn-primary" id="btnPaso2">Siguiente ¬∑ Confirmar alimento ‚Üí</button>
      </div>
    </section>

    <!-- PASO 3 -->
    <section class="step" id="step3">
      <h2>Paso 3 ¬∑ Revisa este alimento</h2>
      <p class="helper">Confirma que est√© correcto antes de agregarlo al pedido.</p>

      <div class="card">
        <div id="resumenItemActual" style="font-size:0.85rem;white-space:pre-line;"></div>
      </div>

      <div class="actions">
        <button class="btn-secondary" id="btnBack3">‚Üê Editar opciones</button>
        <button class="btn-primary" id="btnAgregar">
          Agregar este alimento al pedido +
        </button>
      </div>
    </section>

    <!-- PASO 4 -->
    <section class="step" id="step4">
      <h2>Paso 4 ¬∑ Total, env√≠o y pago</h2>
      <p class="helper">Aqu√≠ ves todo el pedido. Puedes agregar m√°s alimentos o enviar directo a WhatsApp.</p>

      <div class="card" style="margin-bottom: 18px;">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap; margin-bottom: 10px;">

          <div style="font-size:0.85rem;">
            Pedido actual <span class="badge" id="badgeItems">0 alimentos</span>
          </div>
          <button class="btn-secondary" id="btnAgregarOtro">+ Agregar otro alimento</button>
        </div>

        <table>
          <thead>
          <tr>
            <th>Alimento</th>
            <th>Precio</th>
          </tr>
          </thead>
          <tbody id="detallePedido"></tbody>
          <tfoot>
          <tr class="total-row">
            <td>Subtotal alimentos</td>
            <td id="subtotal">$0.00</td>
          </tr>
          <tr class="total-row" id="rowEnvio">
            <td>
              <label style="font-size:0.9rem; font-weight:700; display:flex; align-items:center; gap:6px;">
                <span class="envio-icon">üöö</span>
                <input type="checkbox" id="chkEnvio">
                Env√≠o a domicilio (+$10)
              </label>
            </td>
            <td id="costoEnvio" style="font-size:1rem; font-weight:700;">$0.00</td>
          </tr>
          <tr class="total-row">
            <td>Total a pagar</td>
            <td id="totalGeneral" class="total-final">$0.00</td>
          </tr>
          </tfoot>
        </table>
      </div>

      <div class="card">
        <div class="row">
          <div class="col">
            <label for="metodoPago">M√©todo de pago</label>
            <select id="metodoPago">
              <option value="Efectivo">Efectivo</option>
              <option value="Transferencia">Transferencia</option>
              <option value="Tarjeta">Tarjeta</option>
            </select>
          </div>
          <div class="col">
            <label for="pagaCon">Si paga en efectivo, ¬øcon cu√°nto?</label>
            <input type="number" id="pagaCon" min="0" step="1" placeholder="Ej. 200">
            <div id="textoCambio" class="note"></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="row">
          <div class="col">
            <label for="nombreCliente">Nombre del cliente (opcional)</label>
            <input type="text" id="nombreCliente" placeholder="">
          </div>
          <div class="col">
            <label for="telefonoCliente">Tel√©fono del cliente (opcional)</label>
            <input type="text" id="telefonoCliente" placeholder="">
          </div>
        </div>

        <label for="direccionCliente">Direcci√≥n / punto de entrega</label>
<textarea id="direccionCliente" placeholder="Calle, n√∫mero, colonia..."></textarea>

<button type="button" id="btnUbicacion" class="btn-secondary" style="margin-top:8px;">
  üìç Usar mi ubicaci√≥n de Google Maps
</button>

<div id="ubicacionTexto" class="note" style="margin-top:6px;"></div>

        <label for="referenciaCliente">Referencias adicionales</label>
        <textarea id="referenciaCliente" placeholder="Color de casa, entre calles, piso, etc."></textarea>

        <div class="actions">
          <button class="btn-secondary" id="btnLimpiar">Vaciar pedido</button>
          <button class="btn-primary" id="btnWhatsApp">Enviar pedido a WhatsApp üì≤</button>
        </div>
      </div>
    </section>
  </main>
</div>
<script>
/* === UBICACI√ìN DESDE GOOGLE MAPS === */
let enlaceMaps = "";

document.getElementById("btnUbicacion").addEventListener("click", ()=>{
    if (!navigator.geolocation) {
        alert("Tu dispositivo no permite obtener la ubicaci√≥n.");
        return;
    }

    document.getElementById("ubicacionTexto").textContent = "Obteniendo ubicaci√≥n...";

    navigator.geolocation.getCurrentPosition(
        (pos)=>{
            const lat = pos.coords.latitude.toFixed(6);
            const lng = pos.coords.longitude.toFixed(6);

            enlaceMaps = `https://www.google.com/maps?q=${lat},${lng}`;

            document.getElementById("ubicacionTexto").innerHTML = `
                üìç Ubicaci√≥n detectada:<br>
                <a href="${enlaceMaps}" target="_blank">${enlaceMaps}</a>
            `;

            // Tambi√©n la ponemos en el textarea
            document.getElementById("direccionCliente").value = `Ubicaci√≥n en Maps: ${enlaceMaps}`;
        },
        (err)=>{
            alert("No se pudo obtener la ubicaci√≥n. Activa el GPS o permisos.");
        }
    );
});

</script>
<!-- Carrito flotante -->
<div class="floating-cart" id="floatingCart">
  <span>üõí</span>
  <span id="floatingCartText">0 alimentos ¬∑ $0.00</span>
</div>

<script>
  /* ========= CONSTANTES ========= */
  const COSTO_DOBLE_ADEREZO = 8;
  const COSTO_ENVIO = 10;
  const NUM_WHATSAPP_LA_CARPITA = "525657861068"; // 52 + 10 d√≠gitos

  const ADEREZOS = [
    "Ranch",
    "Mango habanero",
    "Buffalo",
    "Miel habanero",
    "Koreana",
    "BBQ",
    "Ranch habanero"
  ];

  const PRODUCTOS = [
    // INDIVIDUALES
    {id:"boneless", nombre:"Boneless", categoria:"individual", precio:65, incluyePapas:false, tieneAderezo:true},
    {id:"boneless_papas", nombre:"Boneless con papas", categoria:"individual", precio:80, incluyePapas:true, tieneAderezo:true},

    {id:"tenders", nombre:"Tenders (5pz)", categoria:"individual", precio:65, incluyePapas:false, tieneAderezo:true},
    {id:"tenders_papas", nombre:"Tenders (5pz) con papas", categoria:"individual", precio:80, incluyePapas:true, tieneAderezo:true},

    {id:"alitas_ch", nombre:"Alitas chicas (6pz)", categoria:"individual", precio:70, incluyePapas:false, tieneAderezo:true},
    {id:"alitas_ch_papas", nombre:"Alitas chicas (6pz) con papas", categoria:"individual", precio:85, incluyePapas:true, tieneAderezo:true},

    {id:"alitas_gd", nombre:"Alitas grandes (14pz)", categoria:"individual", precio:140, incluyePapas:false, tieneAderezo:true},
    {id:"alitas_gd_papas", nombre:"Alitas grandes (14pz) con papas", categoria:"individual", precio:170, incluyePapas:true, tieneAderezo:true},

    {id:"palomitas", nombre:"Palomitas", categoria:"individual", precio:65, incluyePapas:false, tieneAderezo:true},
    {id:"palomitas_papas", nombre:"Palomitas con papas", categoria:"individual", precio:80, incluyePapas:true, tieneAderezo:true},

    {id:"dedos_ch", nombre:"Dedos de queso chicos (6pz)", categoria:"individual", precio:60, incluyePapas:false, tieneAderezo:true},
    {id:"dedos_ch_papas", nombre:"Dedos de queso chicos (6pz) con papas", categoria:"individual", precio:75, incluyePapas:true, tieneAderezo:true},

    {id:"dedos_gd", nombre:"Dedos de queso grandes (14pz)", categoria:"individual", precio:115, incluyePapas:false, tieneAderezo:true},
    {id:"dedos_gd_papas", nombre:"Dedos de queso grandes (14pz) con papas", categoria:"individual", precio:140, incluyePapas:true, tieneAderezo:true},

    // BANDERILLAS
    {id:"band_salchicha", nombre:"Banderilla de salchicha", categoria:"banderillas", precio:25, incluyePapas:false, tieneAderezo:false},
    {id:"band_queso", nombre:"Banderilla de queso", categoria:"banderillas", precio:30, incluyePapas:false, tieneAderezo:false},
    {id:"band_combinada", nombre:"Banderilla combinada", categoria:"banderillas", precio:35, incluyePapas:false, tieneAderezo:false},

    // MINI BANDERILLAS
    {id:"mini_sal_sola", nombre:"Mini banderillas salchicha (6pz) solas", categoria:"mini", precio:50, incluyePapas:false, tieneAderezo:false},
    {id:"mini_sal_papas", nombre:"Mini banderillas salchicha (6pz) con papas", categoria:"mini", precio:65, incluyePapas:true, tieneAderezo:false},

    {id:"mini_queso_sola", nombre:"Mini banderillas queso (6pz) solas", categoria:"mini", precio:60, incluyePapas:false, tieneAderezo:false},
    {id:"mini_queso_papas", nombre:"Mini banderillas queso (6pz) con papas", categoria:"mini", precio:75, incluyePapas:true, tieneAderezo:false},

    {id:"mini_comb_sola", nombre:"Mini banderillas combinadas (6pz) solas", categoria:"mini", precio:65, incluyePapas:false, tieneAderezo:false},
    {id:"mini_comb_papas", nombre:"Mini banderillas combinadas (6pz) con papas", categoria:"mini", precio:80, incluyePapas:true, tieneAderezo:false},

    // PAPAS SOLAS
    {id:"papas_francesa", nombre:"Papas a la francesa", categoria:"papas", precio:50, incluyePapas:true, tieneAderezo:false},
    {id:"papas_curly", nombre:"Papas curly", categoria:"papas", precio:60, incluyePapas:true, tieneAderezo:false},
    {id:"papas_waffle", nombre:"Papas waffle", categoria:"papas", precio:60, incluyePapas:true, tieneAderezo:false},
    {id:"papas_gajo", nombre:"Papas gajo", categoria:"papas", precio:60, incluyePapas:true, tieneAderezo:false},

    // SUPER COMBOS
    {id:"combo1", nombre:"S√∫per Combo 1 (Boneless + Alitas + papas)", categoria:"super", precio:145, incluyePapas:true, esCombo:true, alimentos:["Boneless","Alitas"]},
    {id:"combo2", nombre:"S√∫per Combo 2 (Tenders + Boneless + papas)", categoria:"super", precio:135, incluyePapas:true, esCombo:true, alimentos:["Tenders","Boneless"]},
    {id:"combo3", nombre:"S√∫per Combo 3 (Dedos de queso + Palomitas + papas)", categoria:"super", precio:115, incluyePapas:true, esCombo:true, alimentos:["Dedos de queso","Palomitas"]},
    {id:"combo4", nombre:"S√∫per Combo 4 (Dedos de queso + Boneless + papas)", categoria:"super", precio:135, incluyePapas:true, esCombo:true, alimentos:["Dedos de queso","Boneless"]},
    {id:"combo5", nombre:"S√∫per Combo 5 (Alitas + Palomitas + papas)", categoria:"super", precio:130, incluyePapas:true, esCombo:true, alimentos:["Alitas","Palomitas"]},
    {id:"combo6", nombre:"S√∫per Combo 6 (Palomitas + Tenders + papas)", categoria:"super", precio:125, incluyePapas:true, esCombo:true, alimentos:["Palomitas","Tenders"]},

    // MEGA COMBOS
    {id:"mega1", nombre:"Mega 1 (Boneless + Alitas + Dedos de queso) - sin papas", categoria:"mega", precio:180, incluyePapas:false, esCombo:true, alimentos:["Boneless","Alitas","Dedos de queso"]},
    {id:"mega2", nombre:"Mega 2 (Tenders + Palomitas + Boneless) - sin papas", categoria:"mega", precio:170, incluyePapas:false, esCombo:true, alimentos:["Tenders","Palomitas","Boneless"]},
    {id:"supermega", nombre:"S√∫per Mega (Tenders + Dedos de queso + Boneless + papas)", categoria:"mega", precio:195, incluyePapas:true, esCombo:true, alimentos:["Tenders","Dedos de queso","Boneless"]},

    // EXTRAS
    {id:"extra_aderezo", nombre:"Vaso extra de aderezo (2 onzas)", categoria:"extra", precio:8, incluyePapas:false, tieneAderezo:false}
  ];

  /* ========= ESTADO ========= */
  let pasoActual = 1;
  const carrito = [];
  let itemPendiente = null;

  /* ========= FUNCIONES DE TEMA ========= */
  function aplicarTemaInicial(){
    const guardado = localStorage.getItem("tema_lacarpita");
    let tema = "light";

    if(guardado){
      tema = guardado;
    }else if(window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches){
      tema = "dark";
    }

    document.documentElement.setAttribute("data-theme", tema);
    actualizarIconoTema(tema);
  }

  function alternarTema(){
    const actual = document.documentElement.getAttribute("data-theme") || "light";
    const nuevo = actual === "light" ? "dark" : "light";
    document.documentElement.setAttribute("data-theme", nuevo);
    localStorage.setItem("tema_lacarpita", nuevo);
    actualizarIconoTema(nuevo);
  }

  function actualizarIconoTema(tema){
    const btn = document.getElementById("btnTheme");
    if(!btn) return;
    btn.textContent = tema === "dark" ? "‚òÄÔ∏è" : "üåô";
  }

  /* ========= UI PASOS / PROGRESO ========= */
  function irPaso(n){
    pasoActual = n;
    document.querySelectorAll(".step").forEach(s=>{
      s.classList.toggle("active", s.id === "step"+n);
    });
    document.querySelectorAll(".step-indicator").forEach(ind=>{
      const num = parseInt(ind.getAttribute("data-step-ind"));
      ind.classList.toggle("active", num === n);
    });
    actualizarProgreso();
  }

  function actualizarProgreso(){
    const totalPasos = 4;
    const texto = document.getElementById("progressText");
    const barra = document.getElementById("progressFill");
    const porcentaje = (pasoActual / totalPasos) * 100;
    if(texto) texto.textContent = `Paso ${pasoActual} de ${totalPasos}`;
    if(barra) barra.style.width = `${porcentaje}%`;
  }

  /* ========= UTILIDADES ========= */
  function cargarAderezosEnSelect(select){
    select.innerHTML = "";
    ADEREZOS.forEach(a=>{
      const opt = document.createElement("option");
      opt.value = a;
      opt.textContent = a;
      select.appendChild(opt);
    });
  }

  function filtrarProductosPorCategoria(cat){
    return PRODUCTOS.filter(p=>p.categoria===cat);
  }

  function obtenerProductoPorId(id){
    return PRODUCTOS.find(p=>p.id===id);
  }

  function actualizarProductos(){
    const cat = document.getElementById("categoria").value;
    const lista = filtrarProductosPorCategoria(cat);
    const selectProducto = document.getElementById("producto");
    selectProducto.innerHTML = "";
    lista.forEach(p=>{
      const opt = document.createElement("option");
      opt.value = p.id;
      opt.textContent = `${p.nombre} - $${p.precio}`;
      selectProducto.appendChild(opt);
    });
    actualizarOpcionesSegunProducto();

  }

  function ocultarSeccionesOpciones(){
    document.getElementById("seccionAderezoIndividual").style.display = "none";
    document.getElementById("seccionDobleAderezo").style.display = "none";
    document.getElementById("chkDobleAderezo").checked = false;

    document.getElementById("seccionTipoPapas").style.display = "none";
    document.getElementById("seccionCondimentosPapas").style.display = "none";
    document.getElementById("seccionMiniBanderillas").style.display = "none";
    document.getElementById("seccionAderezosCombo").style.display = "none";
    document.getElementById("contenedorAderezosCombo").innerHTML = "";
  }

  function actualizarOpcionesSegunProducto(){
    ocultarSeccionesOpciones();
    const idProd = document.getElementById("producto").value;
    const prod = obtenerProductoPorId(idProd);
    if(!prod) return;

    if(prod.tieneAderezo && !prod.esCombo){
      document.getElementById("seccionAderezoIndividual").style.display = "block";
    }

    if(prod.incluyePapas){
      if(prod.categoria === "papas"){
        document.getElementById("seccionTipoPapas").style.display = "none";
      }else{
        document.getElementById("seccionTipoPapas").style.display = "block";
      }
      document.getElementById("seccionCondimentosPapas").style.display = "block";
    }

    if(prod.categoria==="mini" || prod.categoria==="banderillas"){
      document.getElementById("seccionMiniBanderillas").style.display = "block";
    }

    if(prod.esCombo){
      document.getElementById("seccionAderezosCombo").style.display = "block";
      construirCamposAderezosCombo(prod);
    }
  }

  function construirCamposAderezosCombo(prod){
    const cont = document.getElementById("contenedorAderezosCombo");
    cont.innerHTML = "";
    prod.alimentos.forEach((alimento, index)=>{
      const div = document.createElement("div");
      div.style.borderBottom="1px dashed #e0e0e0";
      div.style.paddingBottom="6px";
      div.style.marginBottom="6px";

      const t = document.createElement("div");
      t.textContent = `‚Ä¢ ${alimento}`;
      t.style.fontSize="0.82rem";
      t.style.fontWeight="600";
      t.style.color="#5d4037";
      div.appendChild(t);

      const labelSel = document.createElement("label");
      labelSel.textContent = "Aderezo incluido";
      div.appendChild(labelSel);

      const sel = document.createElement("select");
      sel.id = `combo_aderezo_${index}`;
      sel.style.width="100%";
      ADEREZOS.forEach(a=>{
        const opt = document.createElement("option");
        opt.value=a;
        opt.textContent=a;
        sel.appendChild(opt);
      });
      div.appendChild(sel);

      const rg = document.createElement("div");
      rg.className="radio-group";
      rg.style.marginTop="4px";
      rg.innerHTML = `
        <label><input type="radio" name="combo_modo_${index}" value="Untado" checked> Untado</label>
        <label><input type="radio" name="combo_modo_${index}" value="Aparte"> Aparte</label>
        <label><input type="radio" name="combo_modo_${index}" value="Sin"> Solo (sin aderezo)</label>
      `;
      div.appendChild(rg);

      const chkDiv = document.createElement("div");
      chkDiv.style.marginTop="4px";
      chkDiv.innerHTML = `
        <label style="font-size:0.78rem;">
          <input type="checkbox" id="combo_doble_${index}"> Doble aderezo (+$${COSTO_DOBLE_ADEREZO})
        </label>
      `;
      div.appendChild(chkDiv);

      const extraDiv = document.createElement("div");
      extraDiv.id = `combo_extra_container_${index}`;
      extraDiv.style.display="none";
      extraDiv.style.marginTop="4px";
      extraDiv.innerHTML = `
        <label style="font-size:0.78rem;">Segundo aderezo</label>
        <select id="combo_aderezo_extra_${index}" style="width:100%;margin-top:2px;">
          ${ADEREZOS.map(a=>`<option value="${a}">${a}</option>`).join("")}
        </select>
        <div class="radio-group" style="margin-top:4px;">
          <label><input type="radio" name="combo_modo_extra_${index}" value="Untado" checked> Untado</label>
          <label><input type="radio" name="combo_modo_extra_${index}" value="Aparte"> Aparte</label>
        </div>
      `;
      div.appendChild(extraDiv);

      cont.appendChild(div);

      document.getElementById(`combo_doble_${index}`).addEventListener("change", e=>{
        extraDiv.style.display = e.target.checked ? "block" : "none";
      });
    });
  }

  /* ========= DESCRIPCI√ìN DE OPCIONES ========= */
  function descripcionPapas(prod){
    if(!prod.incluyePapas) return "";
    let texto = "";

    if(prod.categoria === "papas"){
      texto += " | Papas con ";
    }else{
      const selTipo = document.getElementById("tipoPapa");
      const tipo = selTipo.value;
      texto += ` | Papas tipo ${tipo} con `;
    }

    const queso = document.querySelector('input[name="quesoPapa"]:checked').value;
    const catsup = document.querySelector('input[name="catsupPapa"]:checked').value;
    const salsa = document.querySelector('input[name="salsaPapa"]:checked').value;

    texto += `queso: ${queso}, catsup: ${catsup}, salsa: ${salsa}`;
    return texto;
  }

  function descripcionMiniBanderillas(prod){
    if(!(prod.categoria==="mini" || prod.categoria==="banderillas")) return "";
    const queso = document.querySelector('input[name="quesoMini"]:checked').value;
    const catsup = document.querySelector('input[name="catsupMini"]:checked').value;
    const mayo = document.querySelector('input[name="mayoMini"]:checked').value;
    const salsa = document.querySelector('input[name="salsaMini"]:checked').value;
    return ` | Queso: ${queso}, Catsup: ${catsup}, Mayonesa: ${mayo}, Salsa: ${salsa}`;
  }

  /* ========= CONSTRUCCI√ìN DE ITEM ========= */
  function construirItemActual(){
    const idProd = document.getElementById("producto").value;
    const prod = obtenerProductoPorId(idProd);
    if(!prod) return null;

    let nombre = prod.nombre;
    let lineas = [];
    let precio = prod.precio;
    let extras = 0;

    /* ==== INDIVIDUALES ==== */
    if(prod.tieneAderezo && !prod.esCombo){
        const modo1 = document.querySelector('input[name="modoAderezoPrincipal"]:checked').value;

        if(modo1 === "Sin"){
            lineas.push(`‚Ä¢ Sin aderezo`);
        } else {
            const ad1 = document.getElementById("aderezoPrincipal").value;
            lineas.push(`‚Ä¢ ${ad1} ${modo1.toLowerCase()}`);
        }

        if(document.getElementById("chkDobleAderezo").checked){
            const ad2 = document.getElementById("aderezoExtra").value;
            const modo2 = document.querySelector('input[name="modoAderezoExtra"]:checked').value;
            lineas.push(`‚Ä¢ ${ad2} ${modo2.toLowerCase()}`);
            extras += COSTO_DOBLE_ADEREZO;
        }
    }

    /* ==== COMBOS ==== */
    if(prod.esCombo){
        prod.alimentos.forEach((alimento, index)=>{
            const modo = document.querySelector(`input[name="combo_modo_${index}"]:checked`).value;

            if(modo === "Sin"){
                lineas.push(`‚Ä¢ ${alimento}: sin aderezo`);
            } else {
                const ad = document.getElementById(`combo_aderezo_${index}`).value;
                lineas.push(`‚Ä¢ ${alimento}: ${ad} ${modo.toLowerCase()}`);
            }

            const chkDob = document.getElementById(`combo_doble_${index}`);
            if(chkDob && chkDob.checked){
                const adEx = document.getElementById(`combo_aderezo_extra_${index}`).value;
                const modoEx = document.querySelector(`input[name="combo_modo_extra_${index}"]:checked`).value;
                lineas.push(`‚Ä¢ ${alimento}: ${adEx} ${modoEx.toLowerCase()}`);
                extras += COSTO_DOBLE_ADEREZO;
            }
        });
    }

    /* ==== MINIS Y BANDERILLAS ==== */
    if(prod.categoria === "mini" || prod.categoria === "banderillas"){
        const queso = document.querySelector('input[name="quesoMini"]:checked').value;
        const catsup = document.querySelector('input[name="catsupMini"]:checked').value;
        const mayo = document.querySelector('input[name="mayoMini"]:checked').value;
        const salsa = document.querySelector('input[name="salsaMini"]:checked').value;

        lineas.push(`‚Ä¢ Queso ${queso.toLowerCase()}`);
        lineas.push(`‚Ä¢ Catsup ${catsup.toLowerCase()}`);
        lineas.push(`‚Ä¢ Mayonesa ${mayo.toLowerCase()}`);
        lineas.push(`‚Ä¢ Salsa ${salsa.toLowerCase()}`);
    }
/* ==== PAPAS (CORREGIDO Y COMPLETO: incluye untado, aparte y sin) ==== */
if (prod.incluyePapas) {

    // Tipo de papa si aplica
    let tipoPapa = null;
    let costoPapaExtra = 0;

    if (prod.categoria !== "papas") {
        const selTipo = document.getElementById("tipoPapa");
        tipoPapa = selTipo.value;
        costoPapaExtra = parseFloat(selTipo.options[selTipo.selectedIndex].dataset.extra || "0");
    }

    // Condimentos seleccionados
    const queso = document.querySelector('input[name="quesoPapa"]:checked').value;
    const catsup = document.querySelector('input[name="catsupPapa"]:checked').value;
    const salsa = document.querySelector('input[name="salsaPapa"]:checked').value;

    /* Creamos lista de condimentos */
    let condimentos = [];

    // === SALSA ===
    if (salsa === "Sin") condimentos.push("sin salsa");
    else if (salsa === "Aparte") condimentos.push("salsa aparte");
    else if (salsa === "Untado") condimentos.push("salsa untada");

    // === CATSUP ===
    if (catsup === "Sin") condimentos.push("sin catsup");
    else if (catsup === "Aparte") condimentos.push("catsup aparte");
    else if (catsup === "Untado") condimentos.push("catsup untada");

    // === QUESO ===
    if (queso === "Sin") condimentos.push("sin queso");
    else if (queso === "Aparte") condimentos.push("queso aparte");
    else if (queso === "Untado") condimentos.push("queso untado");

    /* Unir condimentos en una sola frase */
    let textoCondimentos = condimentos.join(" y ");

    /* Construcci√≥n final */
    let linea = "‚Ä¢ Papas";

    if (tipoPapa) linea += ` ${tipoPapa}`;
    if (textoCondimentos) linea += ` ${textoCondimentos}`;
    if (costoPapaExtra > 0) linea += " (+$8)";

    lineas.push(linea);

    // üî• SUMAR SOLO 1 VEZ EL EXTRA
    precio += costoPapaExtra;
}

// ‚ùå ELIMINADO: precio += extras (evita suma doble)

// Mant√©n tu return igual
return {
    descripcion: `${nombre}\n${lineas.join("\n")}`,
    precio
};

  /* ========= CARRITO, TOTAL Y CAMBIO ========= */
  function refrescarTabla(){
    const tbody = document.getElementById("detallePedido");
    tbody.innerHTML = "";
    carrito.forEach((item, idx)=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${idx+1}) ${item.descripcion}</td>
        <td>$${item.precio.toFixed(2)}</td>
      `;
      tbody.appendChild(tr);
    });
    document.getElementById("badgeItems").textContent =
      `${carrito.length} alimento${carrito.length!==1?"s":""}`;

    const subtotal = carrito.reduce((s,it)=>s+it.precio,0);
    const envioActivado = document.getElementById("chkEnvio").checked;
    const costoEnvio = envioActivado ? COSTO_ENVIO : 0;
    const total = subtotal + costoEnvio;

    document.getElementById("subtotal").textContent = "$"+subtotal.toFixed(2);
    document.getElementById("costoEnvio").textContent = "$"+costoEnvio.toFixed(2);
    document.getElementById("totalGeneral").textContent = "$"+total.toFixed(2);

    actualizarCambio();
    actualizarCarritoFlotante();
  }

  function actualizarCambio(){
    const subtotal = carrito.reduce((s,it)=>s+it.precio,0);
    const envioActivado = document.getElementById("chkEnvio").checked;
    const costoEnvio = envioActivado ? COSTO_ENVIO : 0;
    const total = subtotal + costoEnvio;

    const pagaCon = parseFloat(document.getElementById("pagaCon").value);
    const texto = document.getElementById("textoCambio");
    if(isNaN(pagaCon) || pagaCon<=0){
      texto.textContent = "";
      return;
    }
    if(pagaCon < total){
      const falta = (total - pagaCon).toFixed(2);
      texto.textContent = `Faltan $${falta} para completar el total.`;
    }else{
      const cambio = (pagaCon - total).toFixed(2);
      texto.textContent = `Cambio: $${cambio}`;
    }
  }

  function limpiarPedido(){
    carrito.length = 0;
    document.getElementById("chkEnvio").checked = false;
    document.getElementById("pagaCon").value = "";
    document.getElementById("textoCambio").textContent = "";
    refrescarTabla();
  }

  /* ========= CARRITO FLOTANTE ========= */
  function actualizarCarritoFlotante(){
    const cart = document.getElementById("floatingCart");
    const text = document.getElementById("floatingCartText");
    const subtotal = carrito.reduce((s,it)=>s+it.precio,0);
    if(carrito.length === 0){
      cart.classList.remove("visible");
      return;
    }
    text.textContent = `${carrito.length} alimento${carrito.length!==1?"s":""} ¬∑ $${subtotal.toFixed(2)}`;
    cart.classList.add("visible");
  }

  /* ========= VALIDACIONES EXTRA ========= */
  function validarPaso1(){
    const prod = document.getElementById("producto").value;
    if(!prod){
      alert("Selecciona un alimento.");
      return false;
    }
    return true;
  }

  function validarAderezoSinDoble(){
    const modo1 = document.querySelector('input[name="modoAderezoPrincipal"]:checked');
    const chkDoble = document.getElementById("chkDobleAderezo");
    if(!modo1 || !chkDoble) return true;

    if(modo1.value === "Sin" && chkDoble.checked){
      alert("Elegiste 'Sin aderezo', no puedes marcar doble aderezo en este caso.");
      chkDoble.checked = false;
      document.getElementById("seccionDobleAderezo").style.display = "none";
      return false;
    }
    return true;
  }

  /* ========= WHATSAPP ========= */
  function enviarWhatsApp(){
    if (carrito.length === 0) {
        alert("Agrega al menos un alimento al pedido.");
        return;
    }

    let msg = "üçó PEDIDO NUEVO - LA CARPITA üçó\n";
    msg += "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n";

    carrito.forEach((item, i)=>{
        msg += `${i+1}) ${item.descripcion}\n`;
        msg += `üí≤ ${item.precio.toFixed(2)}\n`;
        msg += "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n";
    });

    const subtotal = carrito.reduce((s,it)=>s+it.precio,0);
    const envio = document.getElementById("chkEnvio").checked ? COSTO_ENVIO : 0;
    const total = subtotal + envio;

    msg += `Subtotal: $${subtotal.toFixed(2)}\n`;
    msg += `Env√≠o: ${envio ? "$10 üöö" : "No aplica"}\n`;
    msg += `TOTAL: $${total.toFixed(2)}\n\n`;
    // Direcci√≥n escrita o ubicaci√≥n de Google Maps
const direccion = document.getElementById("direccionCliente").value.trim();

if (direccion !== "") {
    msg += `üìç Ubicaci√≥n / Direcci√≥n:\n${direccion}\n\n`;
}

msg += "Gracias por tu pedido üòÑ";


    window.open(`https://wa.me/${NUM_WHATSAPP_LA_CARPITA}?text=${encodeURIComponent(msg)}`);
}


  /* ========= EVENTOS ========= */
  window.addEventListener("DOMContentLoaded", ()=>{
    // Tema
    aplicarTemaInicial();
    document.getElementById("btnTheme").addEventListener("click", alternarTema);

    // Aderezos iniciales
    cargarAderezosEnSelect(document.getElementById("aderezoPrincipal"));
    cargarAderezosEnSelect(document.getElementById("aderezoExtra"));

    // Productos
    actualizarProductos();
    refrescarTabla();
    actualizarProgreso();

    // Eventos de selects
    document.getElementById("categoria").addEventListener("change", actualizarProductos);
    document.getElementById("producto").addEventListener("change", actualizarOpcionesSegunProducto);

    // Doble aderezo
    document.getElementById("chkDobleAderezo").addEventListener("change", e=>{
      document.getElementById("seccionDobleAderezo").style.display = e.target.checked ? "block" : "none";
    });

    // Si el usuario elige "Sin" aderezo principal, desactiva el doble
    document.querySelectorAll('input[name="modoAderezoPrincipal"]').forEach(radio=>{
      radio.addEventListener("change", ()=>{
        const modo = document.querySelector('input[name="modoAderezoPrincipal"]:checked').value;
        if(modo === "Sin"){
          const chk = document.getElementById("chkDobleAderezo");
          chk.checked = false;
          document.getElementById("seccionDobleAderezo").style.display = "none";
        }
      });
    });

    // Pasos
    document.getElementById("btnPaso1").addEventListener("click", ()=>{
      if(!validarPaso1()) return;
      actualizarOpcionesSegunProducto();
      irPaso(2);
    });

    document.getElementById("btnBack2").addEventListener("click", ()=>irPaso(1));

    document.getElementById("btnPaso2").addEventListener("click", ()=>{
      if(!validarAderezoSinDoble()) return;
      const item = construirItemActual();
      if(!item){alert("Selecciona un alimento.");return;}
      itemPendiente = item;
      const texto = `Alimento:\n‚Ä¢ ${item.descripcion}\n\nPrecio:\n‚Ä¢ $${item.precio.toFixed(2)}`;
      document.getElementById("resumenItemActual").textContent = texto;
      irPaso(3);
    });

    document.getElementById("btnBack3").addEventListener("click", ()=>irPaso(2));

    document.getElementById("btnAgregar").addEventListener("click", ()=>{
      if(!itemPendiente){alert("No hay alimento para agregar.");return;}
      carrito.push({...itemPendiente});
      refrescarTabla();
      irPaso(4);
    });

    document.getElementById("btnAgregarOtro").addEventListener("click", ()=>{
      itemPendiente = null;
      irPaso(1);
    });

    document.getElementById("chkEnvio").addEventListener("change", refrescarTabla);
    document.getElementById("pagaCon").addEventListener("input", actualizarCambio);

    document.getElementById("btnLimpiar").addEventListener("click", ()=>{
      if(confirm("¬øVaciar todo el pedido?")){
        limpiarPedido();
      }
    });

    document.getElementById("btnWhatsApp").addEventListener("click", enviarWhatsApp);

    // Carrito flotante
    document.getElementById("floatingCart").addEventListener("click", ()=>{
      if(carrito.length === 0) return;
      irPaso(4);
      window.scrollTo({top:0,behavior:"smooth"});
    });

    // Enter para avanzar de paso 1 a 2 m√°s r√°pido
    document.getElementById("producto").addEventListener("keydown", (e)=>{
      if(e.key === "Enter"){
        e.preventDefault();
        document.getElementById("btnPaso1").click();
      }
    });
  });

/* ==================================================
   üîç BUSCADOR GLOBAL + AUTOCOMPLETE PROFESIONAL
================================================== */

const buscadorGlobal = document.getElementById("buscadorGlobal");
const listaSugerencias = document.getElementById("listaSugerencias");

/* Iconos por categor√≠a */
function iconoCategoria(cat){
  switch(cat){
    case "individual": return "üçó";
    case "papas": return "üçü";
    case "banderillas": return "üå≠";
    case "mini": return "üßÄ";
    case "super": return "üî•";
    case "mega": return "üí•";
    case "extra": return "‚ûï";
    default: return "üçΩÔ∏è";
  }
}

/* Mostrar sugerencias */
buscadorGlobal.addEventListener("input", function(){
  const texto = buscadorGlobal.value.toLowerCase().trim();
  listaSugerencias.innerHTML = "";

  if(texto === ""){
    listaSugerencias.style.display = "none";
    return;
  }

  const resultados = PRODUCTOS.filter(p =>
    p.nombre.toLowerCase().includes(texto)
  );

  if(resultados.length === 0){
    listaSugerencias.style.display = "none";
    return;
  }

  resultados.forEach(prod=>{
    const item = document.createElement("div");

    item.innerHTML = `
      <span class="icon">${iconoCategoria(prod.categoria)}</span>
      ${prod.nombre} - $${prod.precio}
    `;

    item.addEventListener("click", ()=>{
      seleccionarProductoGlobal(prod);
    });

    listaSugerencias.appendChild(item);
  });

  listaSugerencias.style.display = "block";
});

/* Selecci√≥n autom√°tica de categor√≠a + producto */
function seleccionarProductoGlobal(prod){
  // Selecciona categor√≠a correcta
  document.getElementById("categoria").value = prod.categoria;

  // Actualiza lista de productos visibles
  actualizarProductos();

  // Selecciona el producto correcto
  document.getElementById("producto").value = prod.id;

  // Cargar sus opciones
  actualizarOpcionesSegunProducto();

  // Colocar en buscador
  buscadorGlobal.value = prod.nombre;

  // Ocultar sugerencias
  listaSugerencias.style.display = "none";

  // Scroll suave a producto
  document.getElementById("producto").scrollIntoView({behavior:"smooth"});
}

/* Cerrar sugerencias si se hace clic afuera */
document.addEventListener("click", (e)=>{
  if(!buscadorGlobal.contains(e.target)){
    listaSugerencias.style.display = "none";
  }
});


</script>
</body>
</html>



